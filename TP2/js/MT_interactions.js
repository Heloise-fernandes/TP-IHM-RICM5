System.register(["./FSM", "./transfo"], function(exports_1, context_1) {
    "use strict";
    var __moduleName = context_1 && context_1.id;
    var FSM_1, transfo;
    var $;
    //lancer sur ecrantactile :
    //>> gulp default
    //>>node miniServerHTTP.js
    //......!8080
    function multiTouch(element) {
        let pointerId_1, Pt1_coord_element, Pt1_coord_parent, pointerId_2, Pt2_coord_element, Pt2_coord_parent, originalMatrix, getRelevantDataFromEvent = (evt) => {
            for (let i = 0; i < evt.changedTouches.length; i++) {
                let touch = evt.changedTouches.item(i);
                if (touch.identifier === pointerId_1 || touch.identifier === pointerId_2) {
                    return touch;
                }
            }
            return null;
        };
        var MT_STATES;
        (function (MT_STATES) {
            MT_STATES[MT_STATES["Inactive"] = 0] = "Inactive";
            MT_STATES[MT_STATES["Translating"] = 1] = "Translating";
            MT_STATES[MT_STATES["Rotozooming"] = 2] = "Rotozooming";
        })(MT_STATES || (MT_STATES = {}));
        let fsm = FSM_1.FSM.parse({
            initialState: MT_STATES.Inactive,
            states: [MT_STATES.Inactive, MT_STATES.Translating, MT_STATES.Rotozooming],
            transitions: [
                { from: MT_STATES.Inactive, to: MT_STATES.Translating,
                    eventTargets: [element],
                    eventName: ["touchstart"],
                    useCapture: false,
                    action: (evt) => {
                        pointerId_1 = evt.changedTouches.item(0).identifier;
                        Pt1_coord_parent = transfo.getPoint(evt.changedTouches.item(0).clientX, evt.changedTouches.item(0).clientY);
                        originalMatrix = transfo.getMatrixFromElement(element);
                        Pt1_coord_element = Pt1_coord_parent.matrixTransform(originalMatrix.inverse());
                        return true;
                    }
                },
                { from: MT_STATES.Translating, to: MT_STATES.Translating,
                    eventTargets: [document],
                    eventName: ["touchmove"],
                    useCapture: true,
                    action: (evt) => {
                        evt.preventDefault();
                        evt.stopPropagation();
                        Pt1_coord_parent = transfo.getPoint(evt.changedTouches.item(0).clientX, evt.changedTouches.item(0).clientY);
                        transfo.drag(element, originalMatrix, Pt1_coord_element, Pt1_coord_parent);
                        return true;
                    }
                },
                { from: MT_STATES.Translating,
                    to: MT_STATES.Inactive,
                    eventTargets: [document],
                    eventName: ["touchend"],
                    useCapture: true,
                    action: (evt) => {
                        return true;
                    }
                },
                { from: MT_STATES.Translating, to: MT_STATES.Rotozooming,
                    eventTargets: [element],
                    eventName: ["touchstart"],
                    useCapture: false,
                    action: (evt) => {
                        pointerId_2 = evt.changedTouches.item(1).identifier;
                        Pt2_coord_parent = transfo.getPoint(evt.changedTouches.item(1).clientX, evt.changedTouches.item(1).clientY);
                        Pt2_coord_element = Pt2_coord_parent.matrixTransform(originalMatrix.inverse());
                        return true;
                    }
                },
                { from: MT_STATES.Rotozooming, to: MT_STATES.Rotozooming,
                    eventTargets: [document],
                    eventName: ["touchmove"],
                    useCapture: true,
                    action: (evt) => {
                        evt.preventDefault();
                        evt.stopPropagation();
                        Pt2_coord_parent = transfo.getPoint(evt.changedTouches.item(1).clientX, evt.changedTouches.item(1).clientY);
                        transfo.rotozoom(element, originalMatrix, Pt1_coord_element, Pt1_coord_parent, Pt2_coord_element, Pt2_coord_parent);
                        return true;
                    }
                },
                { from: MT_STATES.Rotozooming,
                    to: MT_STATES.Translating,
                    eventTargets: [document],
                    eventName: ["touchend"],
                    useCapture: true,
                    action: (evt) => {
                        let touch = getRelevantDataFromEvent(evt);
                        // To be completed
                        return true;
                    }
                }
            ]
        });
        fsm.start();
    }
    //______________________________________________________________________________________________________________________
    //______________________________________________________________________________________________________________________
    //______________________________________________________________________________________________________________________
    function isString(s) {
        return typeof (s) === "string" || s instanceof String;
    }
    return {
        setters:[
            function (FSM_1_1) {
                FSM_1 = FSM_1_1;
            },
            function (transfo_1) {
                transfo = transfo_1;
            }],
        execute: function() {
            exports_1("$", $ = (sel) => {
                let L = [];
                if (isString(sel)) {
                    L = Array.from(document.querySelectorAll(sel));
                }
                else if (sel instanceof Element) {
                    L.push(sel);
                }
                else if (sel instanceof Array) {
                    L = sel;
                }
                L.forEach(multiTouch);
            });
        }
    }
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIk1UX2ludGVyYWN0aW9ucy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O1FBcUlXLENBQUM7SUFoSVosMkJBQTJCO0lBQzNCLGlCQUFpQjtJQUNqQiwwQkFBMEI7SUFDMUIsYUFBYTtJQUNiLG9CQUFvQixPQUFvQjtRQUNwQyxJQUFJLFdBQW9CLEVBQUUsaUJBQTRCLEVBQUUsZ0JBQTJCLEVBQy9FLFdBQW9CLEVBQUUsaUJBQTRCLEVBQUUsZ0JBQTJCLEVBQy9FLGNBQTBCLEVBQzFCLHdCQUF3QixHQUFHLENBQUMsR0FBZ0I7WUFDeEMsR0FBRyxDQUFBLENBQUMsSUFBSSxDQUFDLEdBQUMsQ0FBQyxFQUFFLENBQUMsR0FBQyxHQUFHLENBQUMsY0FBYyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO2dCQUM1QyxJQUFJLEtBQUssR0FBRyxHQUFHLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDdkMsRUFBRSxDQUFBLENBQUMsS0FBSyxDQUFDLFVBQVUsS0FBSyxXQUFXLElBQUksS0FBSyxDQUFDLFVBQVUsS0FBSyxXQUFXLENBQUMsQ0FBQyxDQUFDO29CQUN0RSxNQUFNLENBQUMsS0FBSyxDQUFDO2dCQUNqQixDQUFDO1lBQ0wsQ0FBQztZQUNELE1BQU0sQ0FBQyxJQUFJLENBQUM7UUFDaEIsQ0FBQyxDQUFDO1FBQ04sSUFBSyxTQUE4QztRQUFuRCxXQUFLLFNBQVM7WUFBRSxpREFBUSxDQUFBO1lBQUUsdURBQVcsQ0FBQTtZQUFFLHVEQUFXLENBQUE7UUFBQSxDQUFDLEVBQTlDLFNBQVMsS0FBVCxTQUFTLFFBQXFDO1FBQ25ELElBQUksR0FBRyxHQUFHLFNBQUcsQ0FBQyxLQUFLLENBQWE7WUFDNUIsWUFBWSxFQUFFLFNBQVMsQ0FBQyxRQUFRO1lBQ2hDLE1BQU0sRUFBRSxDQUFDLFNBQVMsQ0FBQyxRQUFRLEVBQUUsU0FBUyxDQUFDLFdBQVcsRUFBRSxTQUFTLENBQUMsV0FBVyxDQUFDO1lBQzFFLFdBQVcsRUFBRztnQkFDVixFQUFFLElBQUksRUFBRSxTQUFTLENBQUMsUUFBUSxFQUFFLEVBQUUsRUFBRSxTQUFTLENBQUMsV0FBVztvQkFDakQsWUFBWSxFQUFFLENBQUMsT0FBTyxDQUFDO29CQUN2QixTQUFTLEVBQUUsQ0FBQyxZQUFZLENBQUM7b0JBQ3pCLFVBQVUsRUFBRSxLQUFLO29CQUNqQixNQUFNLEVBQUUsQ0FBQyxHQUFnQjt3QkFFckIsV0FBVyxHQUFHLEdBQUcsQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQzt3QkFFcEQsZ0JBQWdCLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FDL0IsR0FBRyxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxFQUNsQyxHQUFHLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQzt3QkFFeEMsY0FBYyxHQUFHLE9BQU8sQ0FBQyxvQkFBb0IsQ0FBQyxPQUFPLENBQUMsQ0FBQzt3QkFFdkQsaUJBQWlCLEdBQUcsZ0JBQWdCLENBQUMsZUFBZSxDQUFDLGNBQWMsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO3dCQUUvRSxNQUFNLENBQUMsSUFBSSxDQUFDO29CQUNwQixDQUFDO2lCQUNBO2dCQUNELEVBQUUsSUFBSSxFQUFFLFNBQVMsQ0FBQyxXQUFXLEVBQUUsRUFBRSxFQUFFLFNBQVMsQ0FBQyxXQUFXO29CQUNwRCxZQUFZLEVBQUUsQ0FBQyxRQUFRLENBQUM7b0JBQ3hCLFNBQVMsRUFBRSxDQUFDLFdBQVcsQ0FBQztvQkFDeEIsVUFBVSxFQUFFLElBQUk7b0JBQ2hCLE1BQU0sRUFBRSxDQUFDLEdBQWdCO3dCQUNyQixHQUFHLENBQUMsY0FBYyxFQUFFLENBQUM7d0JBQ3JCLEdBQUcsQ0FBQyxlQUFlLEVBQUUsQ0FBQzt3QkFFdEIsZ0JBQWdCLEdBQUUsT0FBTyxDQUFDLFFBQVEsQ0FDOUIsR0FBRyxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxFQUNsQyxHQUFHLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQzt3QkFFeEMsT0FBTyxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUMsY0FBYyxFQUFDLGlCQUFpQixFQUFDLGdCQUFnQixDQUFDLENBQUM7d0JBQ3hFLE1BQU0sQ0FBQyxJQUFJLENBQUM7b0JBQ2hCLENBQUM7aUJBQ0o7Z0JBQ0QsRUFBRSxJQUFJLEVBQUUsU0FBUyxDQUFDLFdBQVc7b0JBQ3pCLEVBQUUsRUFBRSxTQUFTLENBQUMsUUFBUTtvQkFDdEIsWUFBWSxFQUFFLENBQUMsUUFBUSxDQUFDO29CQUN4QixTQUFTLEVBQUUsQ0FBQyxVQUFVLENBQUM7b0JBQ3ZCLFVBQVUsRUFBRSxJQUFJO29CQUNoQixNQUFNLEVBQUUsQ0FBQyxHQUFnQjt3QkFDckIsTUFBTSxDQUFDLElBQUksQ0FBQztvQkFDaEIsQ0FBQztpQkFDSjtnQkFDRCxFQUFFLElBQUksRUFBRSxTQUFTLENBQUMsV0FBVyxFQUFFLEVBQUUsRUFBRSxTQUFTLENBQUMsV0FBVztvQkFDcEQsWUFBWSxFQUFFLENBQUMsT0FBTyxDQUFDO29CQUN2QixTQUFTLEVBQUUsQ0FBQyxZQUFZLENBQUM7b0JBQ3pCLFVBQVUsRUFBRSxLQUFLO29CQUNqQixNQUFNLEVBQUUsQ0FBQyxHQUFnQjt3QkFDckIsV0FBVyxHQUFHLEdBQUcsQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQzt3QkFFcEQsZ0JBQWdCLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FDL0IsR0FBRyxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxFQUNsQyxHQUFHLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQzt3QkFFeEMsaUJBQWlCLEdBQUcsZ0JBQWdCLENBQUMsZUFBZSxDQUFDLGNBQWMsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO3dCQUUvRSxNQUFNLENBQUMsSUFBSSxDQUFDO29CQUNoQixDQUFDO2lCQUNKO2dCQUNELEVBQUUsSUFBSSxFQUFFLFNBQVMsQ0FBQyxXQUFXLEVBQUUsRUFBRSxFQUFFLFNBQVMsQ0FBQyxXQUFXO29CQUNwRCxZQUFZLEVBQUUsQ0FBQyxRQUFRLENBQUM7b0JBQ3hCLFNBQVMsRUFBRSxDQUFDLFdBQVcsQ0FBQztvQkFDeEIsVUFBVSxFQUFFLElBQUk7b0JBQ2hCLE1BQU0sRUFBRSxDQUFDLEdBQWdCO3dCQUNyQixHQUFHLENBQUMsY0FBYyxFQUFFLENBQUM7d0JBQ3JCLEdBQUcsQ0FBQyxlQUFlLEVBQUUsQ0FBQzt3QkFFdEIsZ0JBQWdCLEdBQUUsT0FBTyxDQUFDLFFBQVEsQ0FDOUIsR0FBRyxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxFQUNsQyxHQUFHLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQzt3QkFFeEMsT0FBTyxDQUFDLFFBQVEsQ0FBRSxPQUFPLEVBQ3JCLGNBQWMsRUFDZCxpQkFBaUIsRUFDakIsZ0JBQWdCLEVBQ2hCLGlCQUFpQixFQUNqQixnQkFBZ0IsQ0FDbkIsQ0FBQTt3QkFFRCxNQUFNLENBQUMsSUFBSSxDQUFDO29CQUNoQixDQUFDO2lCQUNKO2dCQUNELEVBQUUsSUFBSSxFQUFFLFNBQVMsQ0FBQyxXQUFXO29CQUN6QixFQUFFLEVBQUUsU0FBUyxDQUFDLFdBQVc7b0JBQ3pCLFlBQVksRUFBRSxDQUFDLFFBQVEsQ0FBQztvQkFDeEIsU0FBUyxFQUFFLENBQUMsVUFBVSxDQUFDO29CQUN2QixVQUFVLEVBQUUsSUFBSTtvQkFDaEIsTUFBTSxFQUFFLENBQUMsR0FBZ0I7d0JBQ3JCLElBQUksS0FBSyxHQUFHLHdCQUF3QixDQUFDLEdBQUcsQ0FBQyxDQUFDO3dCQUMxQyxrQkFBa0I7d0JBQ2xCLE1BQU0sQ0FBQyxJQUFJLENBQUM7b0JBQ2hCLENBQUM7aUJBQ0o7YUFDSjtTQUNKLENBQUUsQ0FBQztRQUNKLEdBQUcsQ0FBQyxLQUFLLEVBQUUsQ0FBQztJQUNoQixDQUFDO0lBRUQsd0hBQXdIO0lBQ3hILHdIQUF3SDtJQUN4SCx3SEFBd0g7SUFDeEgsa0JBQWtCLENBQU87UUFDckIsTUFBTSxDQUFDLE9BQU0sQ0FBQyxDQUFDLENBQUMsS0FBSyxRQUFRLElBQUksQ0FBQyxZQUFZLE1BQU0sQ0FBQztJQUN6RCxDQUFDOzs7Ozs7Ozs7O1lBRVUsZUFBQSxDQUFDLEdBQUcsQ0FBQyxHQUFrQztnQkFDOUMsSUFBSSxDQUFDLEdBQWUsRUFBRSxDQUFDO2dCQUN2QixFQUFFLENBQUEsQ0FBRSxRQUFRLENBQUMsR0FBRyxDQUFFLENBQUMsQ0FBQyxDQUFDO29CQUNqQixDQUFDLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBRSxRQUFRLENBQUMsZ0JBQWdCLENBQVMsR0FBRyxDQUFDLENBQUUsQ0FBQztnQkFDN0QsQ0FBQztnQkFBQyxJQUFJLENBQUMsRUFBRSxDQUFBLENBQUMsR0FBRyxZQUFZLE9BQU8sQ0FBQyxDQUFDLENBQUM7b0JBQy9CLENBQUMsQ0FBQyxJQUFJLENBQUUsR0FBRyxDQUFFLENBQUM7Z0JBQ2xCLENBQUM7Z0JBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQSxDQUFDLEdBQUcsWUFBWSxLQUFLLENBQUMsQ0FBQyxDQUFDO29CQUM3QixDQUFDLEdBQUcsR0FBRyxDQUFDO2dCQUNaLENBQUM7Z0JBQ0QsQ0FBQyxDQUFDLE9BQU8sQ0FBRSxVQUFVLENBQUUsQ0FBQztZQUM1QixDQUFDLENBQUEsQ0FBQyIsImZpbGUiOiJNVF9pbnRlcmFjdGlvbnMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBGU00gfSBmcm9tIFwiLi9GU01cIjtcbmltcG9ydCAqIGFzIHRyYW5zZm8gZnJvbSBcIi4vdHJhbnNmb1wiO1xuXG5cblxuLy9sYW5jZXIgc3VyIGVjcmFudGFjdGlsZSA6XG4vLz4+IGd1bHAgZGVmYXVsdFxuLy8+Pm5vZGUgbWluaVNlcnZlckhUVFAuanNcbi8vLi4uLi4uITgwODBcbmZ1bmN0aW9uIG11bHRpVG91Y2goZWxlbWVudDogSFRNTEVsZW1lbnQpIDogdm9pZCB7XG4gICAgbGV0IHBvaW50ZXJJZF8xIDogbnVtYmVyLCBQdDFfY29vcmRfZWxlbWVudCA6IFNWR1BvaW50LCBQdDFfY29vcmRfcGFyZW50IDogU1ZHUG9pbnQsXG4gICAgICAgIHBvaW50ZXJJZF8yIDogbnVtYmVyLCBQdDJfY29vcmRfZWxlbWVudCA6IFNWR1BvaW50LCBQdDJfY29vcmRfcGFyZW50IDogU1ZHUG9pbnQsXG4gICAgICAgIG9yaWdpbmFsTWF0cml4IDogU1ZHTWF0cml4LFxuICAgICAgICBnZXRSZWxldmFudERhdGFGcm9tRXZlbnQgPSAoZXZ0IDogVG91Y2hFdmVudCkgOiBUb3VjaCA9PiB7XG4gICAgICAgICAgICBmb3IobGV0IGk9MDsgaTxldnQuY2hhbmdlZFRvdWNoZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBsZXQgdG91Y2ggPSBldnQuY2hhbmdlZFRvdWNoZXMuaXRlbShpKTtcbiAgICAgICAgICAgICAgICBpZih0b3VjaC5pZGVudGlmaWVyID09PSBwb2ludGVySWRfMSB8fCB0b3VjaC5pZGVudGlmaWVyID09PSBwb2ludGVySWRfMikge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdG91Y2g7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH07XG4gICAgZW51bSBNVF9TVEFURVMge0luYWN0aXZlLCBUcmFuc2xhdGluZywgUm90b3pvb21pbmd9XG4gICAgbGV0IGZzbSA9IEZTTS5wYXJzZTxNVF9TVEFURVM+KCB7XG4gICAgICAgIGluaXRpYWxTdGF0ZTogTVRfU1RBVEVTLkluYWN0aXZlLFxuICAgICAgICBzdGF0ZXM6IFtNVF9TVEFURVMuSW5hY3RpdmUsIE1UX1NUQVRFUy5UcmFuc2xhdGluZywgTVRfU1RBVEVTLlJvdG96b29taW5nXSxcbiAgICAgICAgdHJhbnNpdGlvbnMgOiBbXG4gICAgICAgICAgICB7IGZyb206IE1UX1NUQVRFUy5JbmFjdGl2ZSwgdG86IE1UX1NUQVRFUy5UcmFuc2xhdGluZyxcbiAgICAgICAgICAgICAgICBldmVudFRhcmdldHM6IFtlbGVtZW50XSxcbiAgICAgICAgICAgICAgICBldmVudE5hbWU6IFtcInRvdWNoc3RhcnRcIl0sXG4gICAgICAgICAgICAgICAgdXNlQ2FwdHVyZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgYWN0aW9uOiAoZXZ0IDogVG91Y2hFdmVudCkgOiBib29sZWFuID0+IHtcblxuICAgICAgICAgICAgICAgICAgICBwb2ludGVySWRfMSA9IGV2dC5jaGFuZ2VkVG91Y2hlcy5pdGVtKDApLmlkZW50aWZpZXI7XG5cbiAgICAgICAgICAgICAgICAgICAgUHQxX2Nvb3JkX3BhcmVudCA9IHRyYW5zZm8uZ2V0UG9pbnQoXG4gICAgICAgICAgICAgICAgICAgICAgICBldnQuY2hhbmdlZFRvdWNoZXMuaXRlbSgwKS5jbGllbnRYLFxuICAgICAgICAgICAgICAgICAgICAgICAgZXZ0LmNoYW5nZWRUb3VjaGVzLml0ZW0oMCkuY2xpZW50WSk7XG5cbiAgICAgICAgICAgICAgICAgICAgb3JpZ2luYWxNYXRyaXggPSB0cmFuc2ZvLmdldE1hdHJpeEZyb21FbGVtZW50KGVsZW1lbnQpO1xuXG4gICAgICAgICAgICAgICAgICAgIFB0MV9jb29yZF9lbGVtZW50ID0gUHQxX2Nvb3JkX3BhcmVudC5tYXRyaXhUcmFuc2Zvcm0ob3JpZ2luYWxNYXRyaXguaW52ZXJzZSgpKTtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7IGZyb206IE1UX1NUQVRFUy5UcmFuc2xhdGluZywgdG86IE1UX1NUQVRFUy5UcmFuc2xhdGluZyxcbiAgICAgICAgICAgICAgICBldmVudFRhcmdldHM6IFtkb2N1bWVudF0sXG4gICAgICAgICAgICAgICAgZXZlbnROYW1lOiBbXCJ0b3VjaG1vdmVcIl0sXG4gICAgICAgICAgICAgICAgdXNlQ2FwdHVyZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBhY3Rpb246IChldnQgOiBUb3VjaEV2ZW50KSA6IGJvb2xlYW4gPT4ge1xuICAgICAgICAgICAgICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgZXZ0LnN0b3BQcm9wYWdhdGlvbigpO1xuXG4gICAgICAgICAgICAgICAgICAgIFB0MV9jb29yZF9wYXJlbnQ9IHRyYW5zZm8uZ2V0UG9pbnQoXG4gICAgICAgICAgICAgICAgICAgICAgICBldnQuY2hhbmdlZFRvdWNoZXMuaXRlbSgwKS5jbGllbnRYLFxuICAgICAgICAgICAgICAgICAgICAgICAgZXZ0LmNoYW5nZWRUb3VjaGVzLml0ZW0oMCkuY2xpZW50WSk7XG5cbiAgICAgICAgICAgICAgICAgICAgdHJhbnNmby5kcmFnKGVsZW1lbnQsb3JpZ2luYWxNYXRyaXgsUHQxX2Nvb3JkX2VsZW1lbnQsUHQxX2Nvb3JkX3BhcmVudCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7IGZyb206IE1UX1NUQVRFUy5UcmFuc2xhdGluZyxcbiAgICAgICAgICAgICAgICB0bzogTVRfU1RBVEVTLkluYWN0aXZlLFxuICAgICAgICAgICAgICAgIGV2ZW50VGFyZ2V0czogW2RvY3VtZW50XSxcbiAgICAgICAgICAgICAgICBldmVudE5hbWU6IFtcInRvdWNoZW5kXCJdLFxuICAgICAgICAgICAgICAgIHVzZUNhcHR1cmU6IHRydWUsXG4gICAgICAgICAgICAgICAgYWN0aW9uOiAoZXZ0IDogVG91Y2hFdmVudCkgOiBib29sZWFuID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHsgZnJvbTogTVRfU1RBVEVTLlRyYW5zbGF0aW5nLCB0bzogTVRfU1RBVEVTLlJvdG96b29taW5nLFxuICAgICAgICAgICAgICAgIGV2ZW50VGFyZ2V0czogW2VsZW1lbnRdLFxuICAgICAgICAgICAgICAgIGV2ZW50TmFtZTogW1widG91Y2hzdGFydFwiXSxcbiAgICAgICAgICAgICAgICB1c2VDYXB0dXJlOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBhY3Rpb246IChldnQgOiBUb3VjaEV2ZW50KSA6IGJvb2xlYW4gPT4ge1xuICAgICAgICAgICAgICAgICAgICBwb2ludGVySWRfMiA9IGV2dC5jaGFuZ2VkVG91Y2hlcy5pdGVtKDEpLmlkZW50aWZpZXI7XG5cbiAgICAgICAgICAgICAgICAgICAgUHQyX2Nvb3JkX3BhcmVudCA9IHRyYW5zZm8uZ2V0UG9pbnQoXG4gICAgICAgICAgICAgICAgICAgICAgICBldnQuY2hhbmdlZFRvdWNoZXMuaXRlbSgxKS5jbGllbnRYLFxuICAgICAgICAgICAgICAgICAgICAgICAgZXZ0LmNoYW5nZWRUb3VjaGVzLml0ZW0oMSkuY2xpZW50WSk7XG5cbiAgICAgICAgICAgICAgICAgICAgUHQyX2Nvb3JkX2VsZW1lbnQgPSBQdDJfY29vcmRfcGFyZW50Lm1hdHJpeFRyYW5zZm9ybShvcmlnaW5hbE1hdHJpeC5pbnZlcnNlKCkpO1xuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7IGZyb206IE1UX1NUQVRFUy5Sb3Rvem9vbWluZywgdG86IE1UX1NUQVRFUy5Sb3Rvem9vbWluZyxcbiAgICAgICAgICAgICAgICBldmVudFRhcmdldHM6IFtkb2N1bWVudF0sXG4gICAgICAgICAgICAgICAgZXZlbnROYW1lOiBbXCJ0b3VjaG1vdmVcIl0sXG4gICAgICAgICAgICAgICAgdXNlQ2FwdHVyZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBhY3Rpb246IChldnQgOiBUb3VjaEV2ZW50KSA6IGJvb2xlYW4gPT4ge1xuICAgICAgICAgICAgICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgZXZ0LnN0b3BQcm9wYWdhdGlvbigpO1xuXG4gICAgICAgICAgICAgICAgICAgIFB0Ml9jb29yZF9wYXJlbnQ9IHRyYW5zZm8uZ2V0UG9pbnQoXG4gICAgICAgICAgICAgICAgICAgICAgICBldnQuY2hhbmdlZFRvdWNoZXMuaXRlbSgxKS5jbGllbnRYLFxuICAgICAgICAgICAgICAgICAgICAgICAgZXZ0LmNoYW5nZWRUb3VjaGVzLml0ZW0oMSkuY2xpZW50WSk7XG5cbiAgICAgICAgICAgICAgICAgICAgdHJhbnNmby5yb3Rvem9vbSggZWxlbWVudCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG9yaWdpbmFsTWF0cml4LFxuICAgICAgICAgICAgICAgICAgICAgICAgUHQxX2Nvb3JkX2VsZW1lbnQsXG4gICAgICAgICAgICAgICAgICAgICAgICBQdDFfY29vcmRfcGFyZW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgUHQyX2Nvb3JkX2VsZW1lbnQsXG4gICAgICAgICAgICAgICAgICAgICAgICBQdDJfY29vcmRfcGFyZW50XG4gICAgICAgICAgICAgICAgICAgIClcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgeyBmcm9tOiBNVF9TVEFURVMuUm90b3pvb21pbmcsXG4gICAgICAgICAgICAgICAgdG86IE1UX1NUQVRFUy5UcmFuc2xhdGluZyxcbiAgICAgICAgICAgICAgICBldmVudFRhcmdldHM6IFtkb2N1bWVudF0sXG4gICAgICAgICAgICAgICAgZXZlbnROYW1lOiBbXCJ0b3VjaGVuZFwiXSxcbiAgICAgICAgICAgICAgICB1c2VDYXB0dXJlOiB0cnVlLFxuICAgICAgICAgICAgICAgIGFjdGlvbjogKGV2dCA6IFRvdWNoRXZlbnQpIDogYm9vbGVhbiA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGxldCB0b3VjaCA9IGdldFJlbGV2YW50RGF0YUZyb21FdmVudChldnQpO1xuICAgICAgICAgICAgICAgICAgICAvLyBUbyBiZSBjb21wbGV0ZWRcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICBdXG4gICAgfSApO1xuICAgIGZzbS5zdGFydCgpO1xufVxuXG4vL19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19cbi8vX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX1xuLy9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXG5mdW5jdGlvbiBpc1N0cmluZyhzIDogYW55KSA6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0eXBlb2YocykgPT09IFwic3RyaW5nXCIgfHwgcyBpbnN0YW5jZW9mIFN0cmluZztcbn1cblxuZXhwb3J0IGxldCAkID0gKHNlbCA6IHN0cmluZyB8IEVsZW1lbnQgfCBFbGVtZW50W10pIDogdm9pZCA9PiB7XG4gICAgbGV0IEwgOiBFbGVtZW50W10gPSBbXTtcbiAgICBpZiggaXNTdHJpbmcoc2VsKSApIHtcbiAgICAgICAgTCA9IEFycmF5LmZyb20oIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoPHN0cmluZz5zZWwpICk7XG4gICAgfSBlbHNlIGlmKHNlbCBpbnN0YW5jZW9mIEVsZW1lbnQpIHtcbiAgICAgICAgTC5wdXNoKCBzZWwgKTtcbiAgICB9IGVsc2UgaWYoc2VsIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgICAgTCA9IHNlbDtcbiAgICB9XG4gICAgTC5mb3JFYWNoKCBtdWx0aVRvdWNoICk7XG59O1xuIl0sInNvdXJjZVJvb3QiOiIifQ==
